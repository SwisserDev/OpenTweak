<Window x:Class="OpenTweak.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:OpenTweak.ViewModels"
        Title="OpenTweak"
        Height="720" Width="1100"
        MinHeight="650" MinWidth="950"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        Background="{StaticResource BackgroundDarkBrush}">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="280"/>
        </Grid.ColumnDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Grid.ColumnSpan="2" Padding="20,14"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="OpenTweak" FontSize="18" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Text="Open Source FiveM Optimizer"
                               Foreground="{StaticResource TextMutedBrush}"
                               Margin="12,0,0,0" VerticalAlignment="Center" FontSize="12"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Border Padding="8,4" CornerRadius="4" Margin="0,0,8,0"
                            Background="{Binding IsAdmin, Converter={StaticResource BoolToAdminBrush}}">
                        <TextBlock Text="{Binding IsAdmin, Converter={StaticResource BoolToAdminText}}"
                                   FontSize="10" Foreground="White"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tweak Grid (Left Side) -->
        <ItemsControl Grid.Row="1" Grid.Column="0" ItemsSource="{Binding Tweaks}" Margin="16,16,8,16">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="4" Rows="5"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Margin="3" Padding="10" CornerRadius="6" Cursor="Hand"
                            Background="{StaticResource BackgroundCardBrush}"
                            BorderThickness="2">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="BorderBrush" Value="{StaticResource AccentGreenBrush}"/>
                                    </DataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="BorderBrush" Value="{StaticResource BorderHoverBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick"
                                          Command="{Binding DataContext.SelectTweakCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                          CommandParameter="{Binding}"/>
                        </Border.InputBindings>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Row 1: Checkbox + Name -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal">
                                <CheckBox Style="{StaticResource TweakCheckBox}"
                                          IsChecked="{Binding IsEnabled}" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding Info.Name}" FontWeight="SemiBold" FontSize="12"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="6,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <!-- Row 2: Status Dot + Status -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="26,4,0,0">
                                <Ellipse Width="6" Height="6" VerticalAlignment="Center">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="#666666"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsApplied}" Value="True">
                                                    <Setter Property="Fill" Value="{StaticResource AccentGreenBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock Text="{Binding Status}" FontSize="10"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           Margin="5,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <!-- Row 3: Rating Badge -->
                            <Border Grid.Row="2" HorizontalAlignment="Left" Margin="26,5,0,0"
                                    Padding="5,2" CornerRadius="3">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Effective">
                                                <Setter Property="Background" Value="#1a22c55e"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Minimal">
                                                <Setter Property="Background" Value="#1aeab308"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Placebo">
                                                <Setter Property="Background" Value="#1aef4444"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="{Binding EffectivenessText}" FontSize="9">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Effective">
                                                    <Setter Property="Foreground" Value="{StaticResource AccentGreenBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Minimal">
                                                    <Setter Property="Foreground" Value="{StaticResource AccentYellowBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Placebo">
                                                    <Setter Property="Foreground" Value="{StaticResource AccentRedBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Border>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Sidebar (Right Side) -->
        <Border Grid.Row="1" Grid.Column="1" Margin="8,16,16,16" Padding="16"
                Background="{StaticResource BackgroundCardBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                CornerRadius="8">
            <Grid DataContext="{Binding SelectedTweak}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Tweak Name -->
                <TextBlock Grid.Row="0" Text="{Binding Info.Name}" FontSize="16" FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}"/>

                <!-- Status -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,0">
                    <TextBlock Text="Status:" FontSize="11" Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock Text="{Binding Status}" FontSize="11" Margin="6,0,0,0"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Rating -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,4,0,0">
                    <TextBlock Text="Rating:" FontSize="11" Foreground="{StaticResource TextMutedBrush}"/>
                    <TextBlock Text="{Binding EffectivenessText}" FontSize="11" Margin="6,0,0,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Effective">
                                        <Setter Property="Foreground" Value="{StaticResource AccentGreenBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Minimal">
                                        <Setter Property="Foreground" Value="{StaticResource AccentYellowBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Info.Effectiveness}" Value="Placebo">
                                        <Setter Property="Foreground" Value="{StaticResource AccentRedBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>

                <!-- Details ScrollViewer -->
                <ScrollViewer Grid.Row="3" Margin="0,12,0,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- What it does -->
                        <TextBlock Text="What it does" FontSize="10" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                        <TextBlock Text="{Binding Info.TechnicalDetails}" FontSize="10" TextWrapping="Wrap"
                                   Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,12"/>

                        <!-- Technical -->
                        <TextBlock Text="Technical" FontSize="10" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                        <Border Background="{StaticResource BackgroundDarkBrush}"
                                CornerRadius="4" Padding="8">
                            <TextBlock Text="{Binding Info.WhatItDoes}" FontSize="9" TextWrapping="Wrap"
                                       FontFamily="Consolas" Foreground="{StaticResource AccentBlueBrush}"/>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Action Buttons -->
        <Border Grid.Row="2" Grid.ColumnSpan="2" Padding="16,12"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <Button Content="{Binding OptimizeButtonText}" Style="{StaticResource PrimaryButton}"
                            Command="{Binding OptimizeAllCommand}" Width="140"
                            IsEnabled="{Binding IsOptimizing, Converter={StaticResource InvertBool}}"/>
                    <Button Content="Clean Cache" Style="{StaticResource SecondaryButton}"
                            Command="{Binding CleanCacheCommand}" Margin="8,0,0,0"/>
                    <Button Content="Clean RAM" Style="{StaticResource SecondaryButton}"
                            Command="{Binding CleanRamCommand}" Margin="8,0,0,0"/>
                    <Button Content="Restore All" Style="{StaticResource SecondaryButton}"
                            Command="{Binding RevertAllCommand}" Margin="8,0,0,0"/>
                </StackPanel>
                <Button Content="{Binding ShowLog, Converter={StaticResource BoolToLogButton}}"
                        Style="{StaticResource IconButton}" HorizontalAlignment="Right"
                        Command="{Binding ToggleLogCommand}" ToolTip="Toggle Log"/>
            </Grid>
        </Border>

        <!-- Status Bar / Log -->
        <Border Grid.Row="3" Grid.ColumnSpan="2" Padding="16,8"
                Background="{StaticResource BackgroundMediumBrush}">
            <Grid>
                <!-- Status when log hidden -->
                <TextBlock Visibility="{Binding ShowLog, Converter={StaticResource InvertBoolToVis}}"
                           Style="{StaticResource MutedText}">
                    <Run Text="{Binding StatusSummary, Mode=OneWay}"/>
                    <Run Text=" | OpenTweak v1.0 | 100% Open Source | Free Forever"/>
                </TextBlock>

                <!-- Log when visible -->
                <ScrollViewer Visibility="{Binding ShowLog, Converter={StaticResource BoolToVis}}"
                              MaxHeight="120" VerticalScrollBarVisibility="Auto">
                    <TextBlock Text="{Binding LogText}" FontFamily="Consolas" FontSize="10"
                               Foreground="{StaticResource TextMutedBrush}" TextWrapping="Wrap"/>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
